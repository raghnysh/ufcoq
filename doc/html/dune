;;; Dune file for the HTML documentation of the project

;; This file declares the dune parameters for the HTML documentation
;; of the project.

;; The rule stanza declares the various files that must be generated,
;; their prerequisites, and the steps of the generation process.
;;
;;   - The targets field declares the files that are to be generated.
;;
;;   - The package field says that the generated files are to be
;;     considered a part of the ufcoq-doc package declared in the
;;     dune-project file at the project root.
;;
;;   - The deps field says that the ufcoq package must be built before
;;     building this package.  This is because the coqdoc tool which
;;     is used to generate the HTML files needs the glob files that
;;     are a product of building the ufcoq package.
;;
;;   - The action field declares the steps that must be taken to
;;     generate the files mentioned in the targets field.  In this
;;     case, there is only one step which says that the usual coqdoc
;;     command must be run.  The arguments of the coqdoc command use
;;     the variable reference %{project_root}, which dune will replace
;;     with the absolute path of the project root directory (the
;;     directory containing the dune-project file).

(rule
  (targets
    toc.html
    index.html
    coqdoc.css
    ufcoq.base.primitive.html
    ufcoq.base.construct.html
    ufcoq.base.ident.html
    ufcoq.base.elident.html
    ufcoq.base.transport.html
    ufcoq.base.examples.html)
  (package ufcoq-doc)
  (deps (package ufcoq))
  (action
    (run coqdoc
      -Q %{project_root}/src ufcoq
      --html
      --charset utf-8
      --interpolate
      --toc
      %{project_root}/src/base/primitive.v
      %{project_root}/src/base/construct.v
      %{project_root}/src/base/ident.v
      %{project_root}/src/base/elident.v
      %{project_root}/src/base/transport.v
      %{project_root}/src/base/examples.v)))

;; The next stanza specifies how the HTML files generated by the above
;; rule must be installed.
;;
;;   - The package field says that the files must be installed as a
;;     part of the ufcoq-doc package.
;;
;;   - The section field says that the files must be installed in the
;;     doc section of the ufcoq-doc package which was specified in the
;;     package field.  This means that the HTML files will be
;;     installed in the subdirectory
;;                _build/install/default/doc/ufcoq-doc
;;     of the project root.
;;
;;   - The value of the files field is an association list each
;;     element of which is a pair of the form
;;                (built-file as installed-file).
;;     In each such pair, built-file must be one of the files in the
;;     targets field of the above rule stanza.  The installation
;;     process will copy built-file to installed-file in the above
;;     installation directory.  For example, the pair
;;                (toc.html as html/toc.html)
;;     says that the file toc.html from the targets field of the rule
;;     stanza must be copied to the file
;;                _build/install/default/doc/ufcoq-doc/html/toc.html

(install
  (files
    (toc.html as html/toc.html)
    (index.html as html/index.html)
    (coqdoc.css as html/coqdoc.css)
    (ufcoq.base.primitive.html as html/ufcoq.base.primitive.html)
    (ufcoq.base.construct.html as html/ufcoq.base.construct.html)
    (ufcoq.base.ident.html as html/ufcoq.base.ident.html)
    (ufcoq.base.elident.html as html/ufcoq.base.elident.html)
    (ufcoq.base.transport.html as html/ufcoq.base.transport.html)
    (ufcoq.base.examples.html as html/ufcoq.base.examples.html))
  (section doc)
  (package ufcoq-doc))

;;; End of file

;;; Local Variables:
;;; mode: emacs-lisp
;;; lisp-indent-offset: 2
;;; End:
